(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[670],{84766:function(e,t,r){Promise.resolve().then(r.bind(r,76955))},76955:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return S}});var s=r(19506),a=r(22971),n=r(56425),i=r(3818);let l=e=>{let{farcasterUser:t,loading:r,startFarcasterSignerProcess:a,impersonateUser:n,logout:l}=e;return(0,s.jsx)("div",{children:(0,s.jsxs)("div",{style:{minWidth:"150px"},className:"mt-4",children:[(0,s.jsx)("div",{children:(null==t?void 0:t.status)==="approved"?t.fid?(0,s.jsxs)("div",{children:["Signed in as ",null==t?void 0:t.fid," ",(0,s.jsx)("button",{onClick:l,children:"Logout"})]}):"Something is wrong...":(null==t?void 0:t.status)==="impersonating"?(0,s.jsxs)("div",{children:["Impersonating fid: ",(0,s.jsx)("b",{children:null==t?void 0:t.fid}),","," ",(0,s.jsx)("button",{className:"underline",onClick:l,children:"Logout"}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:" text-slate-400",children:"*Impersonation only works for testing local frames using frames.js to validate messages, as they're mocked. It uses the `cast.fid` of `1` and `cast.hash` value of `0x00...00` as the frame context in payloads."})," "]})]}):(null==t?void 0:t.status)==="pending_approval"?"Approve in Warpcast":(0,s.jsx)("h2",{children:"Sign in to test buttons"})}),(0,s.jsxs)("div",{children:[!(null==t?void 0:t.status)&&(0,s.jsxs)("div",{children:[(0,s.jsx)("form",{action:"",onSubmit:async e=>{e.preventDefault(),n({fid:1})},children:(0,s.jsx)("button",{style:{cursor:r?"not-allowed":"pointer"},className:"underline",type:"submit",disabled:r,children:"Impersonate fid: 1"})}),(0,s.jsx)("div",{children:"or"}),(0,s.jsxs)("form",{action:"",onSubmit:async e=>{e.preventDefault();let{value:t}=e.target[0];n({fid:parseInt(t)})},children:[(0,s.jsx)("input",{type:"text",placeholder:"FID to impersonate"})," ",(0,s.jsx)("button",{style:{cursor:r?"not-allowed":"pointer"},className:"underline",type:"submit",disabled:r,children:"Impersonate"})]}),(0,s.jsx)("div",{children:"or"}),(0,s.jsx)("button",{style:{cursor:r?"not-allowed":"pointer"},className:"underline",onClick:a,disabled:r,children:r?"Loading...":"Sign in with farcaster (costs warps once, works with remote frames and other libs)"})]}),(null==t?void 0:t.status)==="pending_approval"&&(null==t?void 0:t.signerApprovalUrl)&&(0,s.jsxs)("div",{className:"signer-approval-container mr-4",children:["Scan with your camera app",(0,s.jsx)(i.ZP,{value:t.signerApprovalUrl,size:64}),(0,s.jsx)("div",{className:"or-divider",children:"OR"}),(0,s.jsx)("a",{href:t.signerApprovalUrl,target:"_blank",className:"underline",rel:"noopener noreferrer",children:(0,s.jsx)("button",{children:"open url"})})]})]})]})})};function o(e){var t,r;let{frame:n,url:i,submitOption:l,isLoggedIn:o}=e,[d,c]=(0,a.useState)(""),[u,p]=(0,a.useState)(!1);return(0,s.jsxs)("div",{style:{width:"382px"},children:[(0,s.jsx)("img",{src:n.image,alt:"Description of the image",style:{borderRadius:"4px",border:"1px solid #ccc"},...(null!==(r=n.imageAspectRatio)&&void 0!==r?r:"1.91:1")==="1:1"?{width:382,height:382}:{height:200,width:382}}),n.inputText&&(0,s.jsx)("input",{className:"w-full p-2 border mt-1 border-gray-400 rounded",type:"text",placeholder:n.inputText,onChange:e=>c(e.target.value)}),(0,s.jsx)("div",{style:{display:"flex",flexDirection:"row",marginTop:"4px",gap:"4px"},children:null===(t=n.buttons)||void 0===t?void 0:t.map((e,t)=>{let{label:r,action:a,target:i}=e;return(0,s.jsxs)("button",{type:"button",disabled:u,className:"bg-gray-200 p-2 hover:bg-gray-300 ".concat(u?"bg-gray-100 hover:bg-gray-100":""," border-gray-400 border text-sm text-gray-800 rounded"),style:{flex:"1 1 0px",cursor:u?void 0:"pointer"},onClick:async()=>{if(!o){alert("Choose an fid to impersonate or Sign in (costs warps) to use the frame buttons");return}if("link"===a)window.confirm("You are about to be redirected to "+i)&&(window.location.href=i);else if("mint"===a)alert("Requested to mint NFT: ".concat(i));else{p(!0);try{await l({buttonIndex:t+1,inputText:void 0!==n.inputText?d:void 0})}catch(e){alert("error: check the console"),console.error(e)}p(!1)}},children:["mint"===a?"♦ ":"",r,"post_redirect"===a||"link"===a?" ↗":""]},t)})})]})}let d={FARCASTER_USER:"farcasterUser"};var c=r(57785),u=r(31180).Buffer;function p(e){let{privateKeyBytes:t,publicKeyBytes:r}=e;return{publicKey:"0x"+u.from(r).toString("hex"),privateKey:"0x"+u.from(t).toString("hex")}}async function m(){let e=c.P6.randomPrivateKey(),t=await c.Cg(e);return{privateKeyBytes:e,publicKeyBytes:t}}var f=r(19162),h=r(31180).Buffer;async function x(e,t){let{fid:r,url:s,buttonIndex:a,castId:n,inputText:i}=t,l=new f.vJz(h.from(e.slice(2),"hex")),o={fid:r,network:f.ddA.MAINNET},d=await (0,f.uFe)(f.so9.create({url:s,buttonIndex:a,castId:n,inputText:void 0!==i?h.from(i):void 0}),o,l);d.isErr()&&console.error(d.error);let c=h.from(f.v0C.encode(d._unsafeUnwrap()).finish()).toString("hex");return{message:d.unwrapOr(null),trustedBytes:c}}var v=r(36886);function g(e){let{children:t,frameData:r,url:n,framePerformanceInSeconds:i}=e,[l,o]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{l&&setTimeout(()=>{o(!1)},1e3)},[l,o]),(0,s.jsxs)("div",{className:"flex flex-col gap-4 items-start",children:[(0,s.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,s.jsxs)("div",{className:"p-4 flex flex-col gap-4",children:[(0,s.jsxs)("span",{className:"font-bold",children:["Debugging frame at: ",n]}),t]}),(0,s.jsxs)("div",{className:"p-4 h-full",children:[(0,s.jsx)("h3",{className:"font-bold",children:"Frame Validations"}),(0,s.jsxs)("div",{className:"min-w-[400px]",children:[i?(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"row",gap:"8px"},children:[(0,s.jsxs)("div",{children:[" ",i>5?"\uD83D\uDD34":i>4?"\uD83D\uDFE0":"\uD83D\uDFE2"]}),(0,s.jsx)("div",{className:"text-slate-600",children:"frame speed (seconds)"}),(0,s.jsx)("div",{className:"font-bold text-red-800",children:i>5?"Request took more than 5s (".concat(i," seconds). This may be normal: first request will take longer in development (as next.js builds), but in production, clients will timeout requests after 5s"):i>4?"Warning: Request took more than 4s (".concat(i," seconds). Requests will fail at 5s. This may be normal: first request will take longer in development (as next.js builds), but in production, if there's variance here, requests could fail in production if over 5s"):"".concat(i," seconds")})]}):null,v.frameErrorKeys.map(e=>{var t,a,n;return(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"row",gap:"8px"},children:[(0,s.jsx)("div",{children:(null==r?void 0:null===(t=r.errors)||void 0===t?void 0:t[e])||!(null==r?void 0:r.frame)?"\uD83D\uDD34":"\uD83D\uDFE2"}),(0,s.jsx)("div",{className:"text-slate-600",children:e}),(0,s.jsxs)("div",{className:"font-bold text-red-800",children:[" ",null==r?void 0:null===(n=r.errors)||void 0===n?void 0:null===(a=n[e])||void 0===a?void 0:a.join(",")]})]},e)}),(0,s.jsx)("a",{target:"_blank",className:"underline text-slate-400 mt-2 block",href:"https://docs.farcaster.xyz/learn/what-is-farcaster/frames",children:"↗ Farcaster Frames Spec"})]})]})]}),(0,s.jsxs)("div",{className:"bg-slate-100 p-4 flex-1 ",children:[(0,s.jsx)("h3",{className:"font-bold",children:"frames.js Frame object"}),(0,s.jsx)("pre",{id:"json",className:"font-mono text-sm",style:{padding:"10px",borderRadius:"4px"},children:JSON.stringify(null==r?void 0:r.frame,null,2)}),(null==r?void 0:r.frame)?(0,s.jsxs)("div",{className:"py-4 flex-1",children:[(0,s.jsx)("span",{className:"font-bold mr-2",children:"html tags"}),(0,s.jsx)("button",{className:"underline",onClick:()=>{navigator.clipboard.writeText((0,v.getFrameHtmlHead)(null==r?void 0:r.frame)),o(!0)},children:l?"✔︎ copied to clipboard":"copy html tags"}),(0,s.jsx)("pre",{id:"html",style:{padding:"10px",borderRadius:"4px"},children:(0,v.getFrameHtmlHead)(null==r?void 0:r.frame).split("<meta").filter(e=>!!e).flatMap((e,t)=>[(0,s.jsx)("span",{children:"<meta".concat(e)},t),(0,s.jsx)("br",{},"br_".concat(t))])})]}):null]})]})}var b=r(53922),y=r(35609),j=r(31180).Buffer;let w=e=>fetch(e).then(e=>e.json());function S(e){let{searchParams:t}=e,{farcasterUser:r,loading:i,startFarcasterSignerProcess:c,logout:u,impersonateUser:f}=function(){let[e,t]=(0,a.useState)(!1),[r,s]=(0,a.useState)(n());function n(){{let e=localStorage.getItem(d.FARCASTER_USER);if(e){let t=JSON.parse(e);return"pending_approval"===t.status&&t.deadline<Math.floor(Date.now()/1e3)?(localStorage.removeItem(d.FARCASTER_USER),null):t}return null}}async function i(){try{let e=await m(),t=p(e),r=await fetch("/debug/signer",{method:"POST",body:JSON.stringify({publicKey:t.publicKey})}),a=await r.json(),{signature:n,requestFid:i,deadline:l}=a;if(200===r.status){let{result:{signedKeyRequest:e}}=await (await fetch("https://api.warpcast.com/v2/signed-key-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t.publicKey,signature:n,requestFid:i,deadline:l})})).json(),r={...a,publicKey:t.publicKey,deadline:l,token:e.token,signerApprovalUrl:e.deeplinkUrl,privateKey:t.privateKey,status:"pending_approval"};localStorage.setItem(d.FARCASTER_USER,JSON.stringify(r)),s(r)}}catch(e){console.error("API Call failed",e)}}return(0,a.useEffect)(()=>{let e=n();e&&s(e)},[]),(0,a.useEffect)(()=>{if(r&&"pending_approval"===r.status){let e;let t=()=>{e=setInterval(async()=>{try{let t=await fetch("https://api.warpcast.com/v2/signed-key-request?token=".concat(r.token),{method:"GET",headers:{"Content-Type":"application/json"}}),a=await t.json();if("completed"!==a.result.signedKeyRequest.state)throw Error("hasnt succeeded yet");let n={...r,...a.result,fid:a.result.signedKeyRequest.userFid,status:"approved"};localStorage.setItem(d.FARCASTER_USER,JSON.stringify(n)),s(n),clearInterval(e)}catch(e){console.info(e)}},2e3)},a=()=>{clearInterval(e)},n=()=>{document.hidden?a():t()};return document.addEventListener("visibilitychange",n),t(),()=>{document.removeEventListener("visibilitychange",n),clearInterval(e)}}},[r]),{farcasterUser:r,loading:e,startFarcasterSignerProcess:async function(){t(!0),await i(),t(!1)},logout:function(){localStorage.setItem(d.FARCASTER_USER,""),s(null)},impersonateUser:async function(e){let{fid:t}=e,{privateKey:r,publicKey:a}=p(await m()),n={status:"impersonating",fid:t,privateKey:r,publicKey:a};localStorage.setItem(d.FARCASTER_USER,JSON.stringify(n)),s(n)}}}(),h=(0,y.useRouter)(),v=t.url,[S,N]=(0,a.useState)(v||"ourmada.xyz"),[R,k]=(0,a.useState)(void 0),[D,E]=(0,a.useState)(null),{data:T,error:I,isLoading:C,mutate:F}=(0,n.ZP)(v?"/debug/og?url=".concat(v):null,w);(0,a.useEffect)(()=>{k(T)},[T]);let U=async e=>{var t,s;let{buttonIndex:a,inputText:n}=e;if(!r||!r.fid||!R||!(null==R?void 0:R.frame)||!v)return;let i=null==R?void 0:R.frame.buttons[a-1],l={fid:1,hash:new Uint8Array(j.from("0000000000000000000000000000000000000000","hex"))},{message:o,trustedBytes:d}=await x(r.privateKey,{fid:r.fid,buttonIndex:a,castId:l,url:j.from(v),inputText:void 0!==n?j.from(n):void 0});if(!o)throw Error("hub error");let c=new URLSearchParams({postType:(null==i?void 0:i.action)||"post",postUrl:null!==(s=null!==(t=null==i?void 0:i.target)&&void 0!==t?t:R.frame.postUrl)&&void 0!==s?s:v}),u=new Date,p=await fetch("/debug/frame-action?".concat(c.toString()),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({untrustedData:{fid:r.fid,url:v,messageHash:"0x".concat(j.from(o.hash).toString("hex")),timestamp:o.data.timestamp,network:1,buttonIndex:Number(o.data.frameActionBody.buttonIndex),castId:{fid:l.fid,hash:"0x".concat(j.from(l.hash).toString("hex"))},inputText:n},trustedData:{messageBytes:d}})});E(+((new Date().getTime()-u.getTime())/1e3).toFixed(2));let m=await p.json();if(302===p.status){let e=m.location;window.confirm("You are about to be redirected to "+e)&&(window.location.href=e);return}k(m)};if(I)return(0,s.jsx)("div",{children:"Failed to load"});if(C)return(0,s.jsx)("div",{children:"Loading..."});if(v&&!(null==R?void 0:R.frame))return(0,s.jsxs)("div",{children:["Something is wrong, couldn't fetch frame from ",v,"..."," ",v.startsWith("http://")||v.startsWith("https://")?"":"URL must start with http:// or https://"," ",(0,s.jsx)(b.default,{href:"/debug",className:"underline block",children:"Go back"})]});let A="ourmada.xyz";return(0,s.jsx)("div",{className:"",children:(0,s.jsxs)("div",{className:"",children:[(0,s.jsxs)("div",{className:"bg-slate-100 mb-4 p-4",children:[(0,s.jsxs)("div",{className:"flex flex-row gap-4 items-center",children:[(0,s.jsx)("h2",{className:"font-bold",children:"Frames.js debugger"}),(0,s.jsxs)("form",{className:"flex flex-row",onSubmit:e=>{if(e.preventDefault(),console.log("urlInput",S),!(S.startsWith("http://")||S.startsWith("https://"))){alert("URL must start with http:// or https://");return}h.push("?url=".concat(encodeURIComponent(S)))},children:[(0,s.jsx)("input",{type:"text",name:"url",className:"w-[400px] px-2 py-1 border border-gray-400 rounded-l",value:S,onChange:e=>{N(e.target.value)},placeholder:"Enter URL"}),(0,s.jsx)("button",{className:"bg-blue-500 text-white p-2 py-1 rounded-r",children:"Debug"})]}),(0,s.jsx)("span",{className:"ml-4",children:"Examples:"}),(0,s.jsx)("button",{className:"underline",onClick:e=>{e.preventDefault(),h.push("?url=".concat(A))},children:"Home"}),(0,s.jsx)("button",{className:"underline",onClick:e=>{e.preventDefault(),h.push("?url=".concat(A,"/examples/user-data"))},children:"User data"})]}),(0,s.jsx)(l,{farcasterUser:r,loading:i,startFarcasterSignerProcess:c,impersonateUser:f,logout:u})]}),v?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(g,{frameData:R,url:v,framePerformanceInSeconds:D,children:(0,s.jsx)(o,{frame:null==R?void 0:R.frame,url:v,submitOption:U,isLoggedIn:!!(null==r?void 0:r.fid)})})}):null]})})}}},function(e){e.O(0,[549,170,914,126,512,184,744],function(){return e(e.s=84766)}),_N_E=e.O()}]);