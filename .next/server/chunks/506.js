"use strict";exports.id=506,exports.ids=[506],exports.modules={85506:(t,e,a)=>{var n,r,o=Object.create,i=Object.defineProperty,s=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,m=Object.getPrototypeOf,c=Object.prototype.hasOwnProperty,u=(t,e,a,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let r of f(e))c.call(t,r)||r===a||i(t,r,{get:()=>e[r],enumerable:!(n=s(e,r))||n.enumerable});return t},d={};((t,e)=>{for(var a in e)i(t,a,{get:e[a],enumerable:!0})})(d,{bytesToHexString:()=>_,frameErrorKeys:()=>T,getAddressForFid:()=>g,getByteLength:()=>k,getFrame:()=>S,getFrameFlattened:()=>O,getFrameHtml:()=>w,getFrameHtmlHead:()=>E,getFrameMessage:()=>U,getFrameMessageFromRequestBody:()=>B,getTokenFromUrl:()=>W,getTokenUrl:()=>P,getUserDataForFid:()=>b,hexStringToUint8Array:()=>v,isFrameButtonLink:()=>I,isFrameButtonMint:()=>x,isValidVersion:()=>F,normalizeCastId:()=>A,parseButtonElement:()=>N,validateFrameMessage:()=>D}),t.exports=u(i({},"__esModule",{value:!0}),d);var l=a(81144),p=a(22623);async function g({fid:t,options:e={}}){let{fallbackToCustodyAddress:a=!0,hubHttpUrl:n="https://api.neynar.com:2281",hubRequestOptions:r={headers:{api_key:"NEYNAR_FRAMES_JS"}}}=e,o=await fetch(`${n}/v1/verificationsByFid?fid=${t}`,r),{messages:i}=await o.json();if(i[0]){let{data:{verificationAddEthAddressBody:{address:t}}}=i[0];return t}if(!a)return null;{let e=(0,l.createPublicClient)({transport:(0,l.http)(),chain:p.optimism});return await e.readContract({abi:(0,l.parseAbi)(["function custodyOf(uint256 fid) view returns (address)"]),address:"0x00000000fc6c5f01fc30151999387bb99a9f489b",functionName:"custodyOf",args:[BigInt(t)]})}}var y=a(12665);async function b({fid:t,options:e={}}){let{hubHttpUrl:a="https://api.neynar.com:2281",hubRequestOptions:n={headers:{api_key:"NEYNAR_FRAMES_JS"}}}=e,r=await fetch(`${a}/v1/userDataByFid?fid=${t}`,n),{messages:o}=await r.json();if(!o||!(o.length>0))return null;{let t=o.reduce((t,e)=>{let a=y.Message.fromJSON(e);if(a.data?.type!==y.MessageType.USER_DATA_ADD)return;let n=a.data.timestamp,{type:r,value:o}=a.data.userDataBody;return t[r]?a.data.timestamp>t[r].timestamp&&(t[r]={value:o,timestamp:n}):t[r]={value:o,timestamp:n},t},{});return{profileImage:t[y.UserDataType.PFP]?.value,displayName:t[y.UserDataType.DISPLAY]?.value,username:t[y.UserDataType.USERNAME]?.value,bio:t[y.UserDataType.BIO]?.value}}}var h=(r=null!=(n=a(29599))?o(m(n)):{},u(n&&n.__esModule?r:i(r,"default",{value:n,enumerable:!0}),n)),$=a(12665);function I(t){return"link"===t.action}function x(t){return"mint"===t.action}function _(t){return"0x"+Buffer.from(t).toString("hex")}function k(t){return Buffer.from(t).byteLength}function v(t){return new Uint8Array(t.match(/.{1,2}/g).map(t=>parseInt(t,16)))}function A(t){return{fid:t.fid,hash:_(t.hash)}}function B(t){return $.Message.decode(Buffer.from(t?.trustedData?.messageBytes??"","hex"))}function F(t){return"vNext"===t||!!/^\d{4}-\d{2}-\d{2}$/.test(t)}function M(t){let e=t.attribs.name||t.attribs.property,a=e?.split(":")[3];try{return{buttonIndex:parseInt(a||""),content:t.attribs.content}}catch(t){return null}}function S({htmlString:t,url:e}){return function({htmlString:t,url:e}){let a=h.load(t),n=null;function r({key:t,message:e}){n||(n={}),n.hasOwnProperty(t)&&n[t]&&Array.isArray(n[t])?(console.log(`Error: ${t} ${e}`),n[t].push(e)):n[t]=[e]}void 0===a("title").text()&&r({message:"A <title> tag is required in order for your frames to work in Warpcast",key:"<title>"});let o=a("meta[property='fc:frame'], meta[name='fc:frame']").attr("content"),i=a("meta[property='fc:frame:image'], meta[name='fc:frame:image']").attr("content"),s=a("meta[property='fc:frame:image:aspect_ratio'], meta[name='fc:frame:image:aspect_ratio']").attr("content"),f=a("meta[property='fc:frame:post_url'], meta[name='fc:frame:post_url']").attr("content")||e,m=a("meta[property='fc:frame:input:text'], meta[name='fc:frame:input:text']").attr("content"),c=[1,2,3,4].flatMap(t=>a(`meta[property='fc:frame:button:${t}'], meta[name='fc:frame:button:${t}']`).map((t,e)=>M(e)).filter((t,e)=>null!==e).toArray()),u=[1,2,3,4].flatMap(t=>a(`meta[property='fc:frame:button:${t}:action'], meta[name='fc:frame:button:${t}:action']`).map((t,e)=>M(e)).filter((t,e)=>null!==e).toArray()),d=[1,2,3,4].flatMap(t=>a(`meta[property='fc:frame:button:${t}:target'], meta[name='fc:frame:button:${t}:target']`).map((t,e)=>M(e)).filter((t,e)=>null!==e).toArray()),l=[!1,!1,!1,!1],p=c.map(t=>{let e=u.find(e=>e?.buttonIndex===t?.buttonIndex),a=d.find(e=>e?.buttonIndex===t?.buttonIndex);l[t.buttonIndex-1]&&r({message:"Duplicate button",key:`fc:frame:button:${t.buttonIndex}`}),[1,2,3,4].includes(t.buttonIndex)?l[t.buttonIndex-1]=!0:r({message:"Incorrect button index (outside of 1,2,3,4)",key:`fc:frame:button:${t.buttonIndex}`});let n=e?.content!==void 0?e?.content:"post";if("link"!==n||(a?.content||r({message:"No button target, but required for action type link",key:`fc:frame:button:${t.buttonIndex}`}),a?.content?.startsWith("http://")||a?.content?.startsWith("https://")||r({message:"External links MUST use the https://  or http:// protocols. ",key:`fc:frame:button:${t.buttonIndex}`})),!a?.content&&["link","mint"].includes(n)&&r({message:`Button target is required for action type ${n}`,key:`fc:frame:button:${t.buttonIndex}`}),a?.content&&!e&&r({message:"Missing button action (should be 'mint' or 'link')",key:`fc:frame:button:${t.buttonIndex}`}),["post_redirect","post","mint","link",void 0].includes(e?.content)||r({message:"Invalid button action specified",key:`fc:frame:button:${t.buttonIndex}`}),"mint"===n&&a?.content)try{W(a.content)}catch(e){r({message:"Invalid CAIP-10 URL",key:`fc:frame:button:${t.buttonIndex}`})}return{buttonIndex:t.buttonIndex,label:t.content||"",target:a?.content,action:e?.content||"post"}}).sort((t,e)=>t.buttonIndex-e.buttonIndex).map(t=>(I(t)||x(t),{label:t.label,action:t.action,target:t.target}));return l.some((t,e)=>!t&&e<3&&l[e+1])&&r({message:`Gap in buttons sequence, ${l.map((t,e)=>`${t?e+1:""}`).join(",")}`,key:"fc:frame:button:1"}),o?F(o)||r({message:"Invalid version",key:"fc:frame"}):r({message:"No version found in frame",key:"fc:frame"}),i?i?.startsWith("http://")||i?.startsWith("https://")||i?.startsWith("data:image/png;base64,")||i?.startsWith("data:image/jpg;base64,")||i?.startsWith("data:image/jpeg;base64,")||i?.startsWith("data:image/gif;base64,")||r({message:"Image has an unrecognized format. Only jpg, png and gif images are supported",key:"fc:frame:image"}):r({message:"No image found in frame",key:"fc:frame:image"}),s&&"1.91:1"!==s&&"1:1"!==s&&r({message:"Invalid image aspect ratio",key:"fc:frame:image:aspect_ratio"}),f||r({message:"No post_url in frame",key:"fc:frame:post_url"}),k(f)>256&&r({message:"post_url is more than 256 bytes (frames.js generates a longer post_url including system params)",key:"fc:frame:post_url"}),p.length>4&&r({message:"Too many buttons",key:"fc:frame:button"}),m&&k(m)>32&&r({message:"Input text should be max 32 bytes",key:"fc:frame:input:text"}),{frame:{version:o,image:i,imageAspectRatio:s,buttons:p,postUrl:f,inputText:m},errors:n}}({htmlString:t,url:e})}function N(t){let e=t.attribs.name||t.attribs.property,a=e?.split(":")[3];try{return{buttonIndex:parseInt(a||""),content:t.attribs.content}}catch(t){return null}}function w(t,e={}){return`<!DOCTYPE html>
  <html>
    <head>
      <title>${e.title??"frame"}</title>
      ${e.og?.title?`<meta property="og:title" content="${e.og.title}"/>`:""}
      ${E(t)}
      ${e.htmlHead||""}
    </head>
    <body>${e.htmlBody?e.htmlBody:""}</body>
  </html>`}function E(t){return[`<meta name="og:image" content="${t.ogImage||t.image}"/>`,`<meta name="fc:frame" content="${t.version}"/>`,`<meta name="fc:frame:image" content="${t.image}"/>`,`<meta name="fc:frame:post_url" content="${t.postUrl}"/>`,t.imageAspectRatio?`<meta name="fc:frame:image:aspect_ratio" content="${t.imageAspectRatio}"/>`:"",t.inputText?`<meta name="fc:frame:input:text" content="${t.inputText}"/>`:"",...t.buttons?.flatMap((t,e)=>[`<meta name="fc:frame:button:${e+1}" content="${t.label}"/>`,t.action?`<meta name="fc:frame:button:${e+1}:action" content="${t.action}"/>`:"",t.target?`<meta name="fc:frame:button:${e+1}:target" content="${t.target}"/>`:""])??[]].join("")}function O(t){return{"fc:frame":t.version,"fc:frame:image":t.image,"fc:frame:post_url":t.postUrl,"fc:frame:input:text":t.inputText,...t.imageAspectRatio?{"fc:frame:image:aspect_ratio":t.imageAspectRatio}:{},...t.buttons?.reduce((t,e,a)=>({...t,[`fc:frame:button:${a+1}`]:e.label,[`fc:frame:button:${a+1}:action`]:e.action,[`fc:frame:button:${a+1}:target`]:e.target}),{})}}var T=["fc:frame","fc:frame:image","fc:frame:image:aspect_ratio","fc:frame:post_url","fc:frame:input:text","fc:frame:button:1","fc:frame:button:2","fc:frame:button:3","fc:frame:button:4","og:image","og:title"],j=a(12665);async function D(t,{hubHttpUrl:e="https://api.neynar.com:2281",hubRequestOptions:a={headers:{api_key:"NEYNAR_FRAMES_JS"}}}={}){let{headers:n,...r}=a,o=await fetch(`${e}/v1/validateMessage`,{method:"POST",headers:{"Content-Type":"application/octet-stream",...n},body:v(t.trustedData.messageBytes),...r}),i=await o.json();return i.valid?{isValid:!0,message:j.Message.fromJSON(i.message)}:{isValid:!1,message:void 0}}var R=a(12665);async function U(t,{fetchHubContext:e=!0,hubHttpUrl:a="https://api.neynar.com:2281",hubRequestOptions:n={headers:{api_key:"NEYNAR_FRAMES_JS"}}}={}){let r=R.Message.decode(Buffer.from(t.trustedData.messageBytes,"hex")),{buttonIndex:o,inputText:i}=r.data.frameActionBody||{},s=i?Buffer.from(i).toString("utf-8"):void 0,f=r.data.fid,m=r.data.frameActionBody.castId?A(r.data.frameActionBody.castId):void 0,c={buttonIndex:o,castId:m,inputText:s,requesterFid:f};if(!e)return c;{let[e,r,o,i,s,u,d]=await Promise.all([D(t,{hubHttpUrl:a,hubRequestOptions:n}),fetch(`${a}/v1/linkById?fid=${f}&target_fid=${m?.fid}&link_type=follow`,n).then(t=>t.ok||f===m?.fid),fetch(`${a}/v1/linkById?fid=${m?.fid}&target_fid=${f}&link_type=follow`,n).then(t=>t.ok||f===m?.fid),fetch(`${a}/v1/reactionById?fid=${f}&reaction_type=1&target_fid=${m?.fid}&target_hash=${m?.hash}`,n).then(t=>t.ok),fetch(`${a}/v1/reactionById?fid=${f}&reaction_type=2&target_fid=${m?.fid}&target_hash=${m?.hash}`,n).then(t=>t.ok),g({fid:f,options:{hubHttpUrl:a,hubRequestOptions:n}}),b({fid:f,options:{hubHttpUrl:a,hubRequestOptions:n}})]),l={isValid:e.isValid,casterFollowsRequester:o,requesterFollowsCaster:r,likedCast:i,recastedCast:s,requesterVerifiedAddresses:u?[u]:[],requesterUserData:d};return{...c,...l}}}function P({address:t,tokenId:e,chainNamespace:a="eip155",chain:n,chainId:r}){let o=null;if(r?o=r.toString():n&&(o=n.id.toString()),!o)throw Error("Invalid chainName or chain object");return`${a?`${a}:`:""}${o}:${t}${e?`:${e}`:""}`}function W(t){let[e,a,n,r]=t.split(":");if(!e||!a||!n)throw Error("Invalid token URL");return{namespace:e,chainId:parseInt(a),address:n,tokenId:r||void 0}}}};